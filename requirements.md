# Webプレゼンアプリ 要件定義

## 🎯 プロジェクトの目的

Webブラウザ上でMarkdown形式のテキストを入力するだけで、リアルタイムにスライドをプレビューし、生成し、PDFとして出力できるアプリケーションを開発する。

---

## 🧩 コア機能（MVP範囲）

### 1. Markdown入力
- **機能概要**: ブラウザ上でMarkdown形式のテキストを編集可能。
- **使用ライブラリ**: React SimpleMDE (EasyMDE)。
- **サポートするMarkdown記法**:
  - 見出し（`#`, `##`など）
  - リスト（順序あり/なし）
  - コードブロック
  - 画像
  - リンク
  - 水平線（`---`）
  - スライド区切り（`---`）
- **画像挿入**:
  - ドラッグ＆ドロップまたはコピー＆ペーストで対応。
  - MVPでは`URL.createObjectURL()`を使用して一時URLで表示（リロードで失われるが許容）。
  - 将来的にSupabase Storageへアップロードし、URLを挿入する方式に拡張予定。
- **保存機能**: MVPでは未対応（将来的にログインユーザー向けに実装）。

### 2. スライドプレビュー
- **機能概要**: 入力したMarkdownをリアルタイムでスライド形式に変換して表示。
- **スライド区切り**: Markdown内の`---`でページを分割。
- **レンダリング**:
  - Markdownを`remark`でパースし、`remark-gfm`と`remark-html`でHTMLに変換。
  - HTML出力は`dompurify`でサニタイズし、セキュリティを確保（`dangerouslySetInnerHTML`を回避）。
- **テーマ**: ダークモードとライトモードを切り替え可能。
- **使用ライブラリ**: `reveal.js`でスライドを生成。

### 3. PDF出力
- **機能概要**: スライド全体を1つのPDFファイルとしてエクスポート。
- **実装方法**:
  - `reveal.js`のprint-pdf機能を使用。
  - ブラウザの印刷機能（`window.print()`）を活用。
- **出力形式**: スライドごとにページ分割されたPDF。
- **オプション（将来的）**: 用紙サイズや余白の調整機能（MVPでは後回し）。

---

## 🛠 技術スタック

### フロントエンド
- **フレームワーク**: Next.js (App Router)
- **UIライブラリ**: React + Tailwind CSS
- **状態管理**: `useState`および`useContext`

### Markdown処理
- **入力**: React SimpleMDE (EasyMDE)
- **パース・変換**:
  - `remark` + `remark-gfm` + `remark-html`でMarkdownをHTMLに変換。
  - `dompurify`でHTMLをサニタイズ。
- **スライド生成**: `reveal.js`（スライド表示およびPDF出力に対応）

### PDF出力
- **ライブラリ**: `reveal.js`のprint-pdf機能
- **スタイリング**: テーマCSSでPDF向けスタイルを調整
- **印刷**: ブラウザの`window.print()`を使用

---

## 🖼 UI構成

###  ダッシュボード画面
- **内容**:
  - 保存済みスライドの一覧表示
  - 新規作成ボタンおよび編集ボタン

---

## 💡 仕様の詳細

- **スライド区切り**: Markdown内の`---`を基準にページを分割（シンプルかつ明示的）。
- **PDF出力**: 専用ボタンに加え、Ctrl+Pによるブラウザ印刷にも対応。
- **ダークモード**: Tailwind CSSで管理し、ライト/ダークテーマを切り替え可能。
- **エディタ設計**:
  - 初期は素のMarkdown編集を採用し、構造的な入力に特化。
  - リアルタイムプレビューで構文理解を補助。
  - 将来的にWYSIWYG形式の入力UIを検討。
- **ユーザー種別と機能制限**:
  - **ログインなしユーザー**: Markdown編集、リアルタイムプレビュー、PDF出力が可能だが、保存は不可。即席プレゼン作成をサポート。
  - **ログインユーザー**: スライドおよび画像の保存が可能（将来的実装）。
- **シンタックスハイライト**:
  - コードブロックに`highlight.js`を適用。
  - `reveal.js`の標準機能では不足するため、カスタムスクリプトで統合。
  - スライドレンダリング時にコードブロックを検出し、`highlight.js`のAPIでハイライト処理を実行。

---

## 📦 使用ライブラリ

- **Markdownエディタ**: `react-simplemde-editor`
- **Markdown処理**:
  - `remark`, `remark-gfm`, `remark-html`（パースおよびHTML変換）
  - `dompurify`（HTMLサニタイズ）
- **スライド生成**: `reveal.js`（スライド表示およびPDF出力）
- **シンタックスハイライト**: `highlight.js`
- **スタイリング**: `tailwindcss`
- **型安全**: `typescript`

---

## 🔄 処理の流れ

1. **Markdown入力**
   - ユーザーがMarkdownエディタに入力。
   - 入力内容を`useState`と`useContext`で状態管理。

2. **Markdown変換**
   - 入力されたMarkdownを`remark`でパース。
   - `remark-gfm`と`remark-html`でHTMLに変換。
   - `dompurify`でHTMLをサニタイズ。

3. **スライドプレビュー**
   - サニタイズ済みHTMLを`reveal.js`でスライド形式にレンダリング。
   - コードブロックに`highlight.js`でシンタックスハイライトを適用。  
    (revealのプラグインでは対応できなかったため、カスタムスクリプトで統合)
   - プレビュー画面にリアルタイムで反映。

4. **カーソル位置とスライド同期**
   - Markdownエディタのカーソル位置を監視。
   - カーソル位置に対応するスライドをアクティブ化。
   - 状態管理は`useState`と`useContext`で実装。

5. **PDF出力**
   - ユーザーがPDF出力ボタンをクリック。
   - html2pdf.jsパッケージをつかってPDF出力。
6. **保存（将来的な機能）**
   - ログインユーザーの場合、Supabase StorageにMarkdownと画像を保存。
   - 保存データはダッシュボード画面で一覧表示可能。

---

## 📝 補足

- 本要件定義はMVP（Minimum Viable Product）を中心に記述。
- 保存機能やダッシュボード画面は将来的な拡張として後回し。
- シンプルな設計を維持しつつ、ユーザビリティと拡張性を確保。